"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[432],{410:(e,t,a)=>{a.d(t,{mJ:()=>r});let r="GET_FORMS_CONFIGURATION_ALL"},1109:(e,t,a)=>{function r(e){let t=(e||"").toLowerCase();return"admin"===t||"manager"===t||"user"===t||"guest"===t?t:"guest"}function s(e,t){return"public"===t||t.includes(e)}a.d(t,{G:()=>r,z:()=>s})},16559:(e,t,a)=>{a.d(t,{$v:()=>h,EO:()=>f,Lt:()=>o,Rx:()=>x,Zr:()=>y,ck:()=>p,r7:()=>g,tv:()=>d,wd:()=>m});var r=a(95155),s=a(12115),l=a(17649),n=a(34449),i=a(97168);let o=l.bL,d=l.l9,c=l.ZL,u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});u.displayName=l.hJ.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]})});f.displayName=l.UC.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};m.displayName="AlertDialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="AlertDialogFooter";let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...s})});g.displayName=l.hE.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});h.displayName=l.VY.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.rc,{ref:t,className:(0,n.cn)((0,i.r)(),a),...s})});x.displayName=l.rc.displayName;let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.ZD,{ref:t,className:(0,n.cn)((0,i.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...s})});y.displayName=l.ZD.displayName},17611:(e,t,a)=>{a.d(t,{$c:()=>h,Iy:()=>p,UC:()=>g});var r=a(57383);let s="access_token",l="refresh_token",n="user_id",i="user_role";a(8777);var o=a(49641).Buffer;let d=window.crypto.subtle;async function c(){console.log(1);try{let e=new TextEncoder().encode("d376510d93962d354924c88547463f2722b512c5b36449195b2c93883398f625"),t=await d.digest("SHA-256",e);return d.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}catch(e){console.warn(1,e.message)}}async function u(e){let t=await c(),a=crypto.getRandomValues(new Uint8Array(12)),r=new TextEncoder,s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,r.encode(e)),l=new Uint8Array(a.byteLength+s.byteLength);return l.set(a,0),l.set(new Uint8Array(s),a.byteLength),(void 0!==o?o.from(l).toString("base64"):btoa(String.fromCharCode(...l))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}async function f(e){if(!e)return null;try{let t=await c(),a=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/")+"===".slice((e.length+3)%4),a=void 0!==o?o.from(t,"base64"):atob(t);if("string"==typeof a){let e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);return e}return new Uint8Array(a)}(e),r=a.slice(0,12),s=a.slice(12),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,s);return new TextDecoder().decode(l)}catch(e){return console.warn("Failed to decrypt cookie value",e),null}}var m=a(1109);async function p(){let e=r.A.get(s)||null,t=r.A.get(l)||null,a=r.A.get(n)||null,o=r.A.get(i)||null,d=await f(a),c=await f(o);return{accessToken:await f(e),refreshToken:await f(t),userId:d?parseInt(d,10):null,role:(0,m.G)(c)}}async function g(e){let{accessToken:t,refreshToken:a,userId:o,role:d}=e,c=await u(t),f=await u(a),m=await u(o.toString());if(r.A.set(s,c),r.A.set(l,f),r.A.set(n,m),d){let e=await u(d);r.A.set(i,e)}}async function h(){r.A.remove(s),r.A.remove(l),r.A.remove(n),r.A.remove(i)}},23750:(e,t,a)=>{a.d(t,{To:()=>r,qv:()=>s,tT:()=>l});let r=[],s={"/login":"public","/forbidden":"public","/401":"public","/403":"public"},l={"/settings":["admin","manager","user"],"/admin":["admin"]}},34964:(e,t,a)=>{a.d(t,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>i});var r=a(95155),s=a(12115),l=a(60704),n=a(34449);let i=l.bL,o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...s})});o.displayName=l.B8.displayName;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...s})});d.displayName=l.l9.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});c.displayName=l.UC.displayName},41810:(e,t,a)=>{a.d(t,{H:()=>l});var r=a(65453),s=a(87991);let l=(0,r.v)((e,t)=>({categories:[],categoriesById:{},isLoading:!1,error:null,fetchCategories:async()=>{try{e({isLoading:!0,error:null});let t=(await (0,s.I3)()).data||[],a=t.reduce((e,t)=>(e[String(t.id)]=t.name,e),{});e({categories:t,categoriesById:a,isLoading:!1,error:null})}catch(t){e({isLoading:!1,error:t instanceof Error?t.message:"Failed to fetch categories"})}},clearError:()=>e({error:null})}))},44380:(e,t,a)=>{a.d(t,{q:()=>l});var r=a(23750);let s=(()=>{let e={...r.qv};for(let t of r.To)for(let a of t.items)e[a.url]=a.roles;for(let[t,a]of Object.entries(r.tT))e[t]=a;return e})();function l(e){if(s[e])return s[e];let t=e.split("?")[0].split("#")[0].split("/").filter(Boolean);if(0===t.length)return s["/"];let a="";for(let e=0;e<t.length;e++)if(s[a+="/"+t[e]])return s[a]}},65103:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(12115),s=a(35695),l=a(81775),n=a(1109),i=a(44380);function o(){let e=(0,s.useRouter)(),t=(0,s.usePathname)(),{role:a,isLoaded:o,hydrateFromServer:d}=(0,l.n)();(0,r.useEffect)(()=>{o||d()},[o,d]),(0,r.useEffect)(()=>{let r=(0,i.q)(t);r&&"public"!==r&&o&&!(0,n.z)(a,r)&&e.replace("/forbidden")},[t,a,o,e])}},81775:(e,t,a)=>{a.d(t,{n:()=>r});let r=(0,a(65453).v)(e=>({role:"guest",isLoaded:!1,setRole:t=>e({role:t}),hydrateFromServer:async()=>{e({role:"guest",isLoaded:!0})}}))},82714:(e,t,a)=>{a.d(t,{J:()=>d});var r=a(95155),s=a(12115),l=a(40968),n=a(74466),i=a(34449);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),a),...s})});d.displayName=l.b.displayName},87991:(e,t,a)=>{a.d(t,{I3:()=>i,hu:()=>l,Oh:()=>n});var r=a(17611);let s=function(e){async function t(){var t;let a=await e.get(),r=null!==(t=null==a?void 0:a.refreshToken)&&void 0!==t?t:null;if(!r)throw Error("No refresh token");let s=await fetch("http://carehomes-dev.eba-8v8h9sbp.us-east-1.elasticbeanstalk.com/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})});if(!s.ok)throw await e.clear(),Error("Refresh failed");let l=await s.json();return await e.set(l),l.accessToken}return async function(a){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{accessToken:s}=await e.get();if(!s)try{s=await t()}catch(e){throw console.error("Auth required: No access token and refresh failed.",e),Error("No access token available")}let l=await fetch("http://carehomes-dev.eba-8v8h9sbp.us-east-1.elasticbeanstalk.com/api"+a,{...r,headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json",Accept:"application/json","X-Tenant":"first",...r.headers||{}},cache:"no-store"});if(401===l.status&&(s=await t(),l=await fetch("http://carehomes-dev.eba-8v8h9sbp.us-east-1.elasticbeanstalk.com/api"+a,{...r,headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json",...r.headers||{}}})),!l.ok)throw Error("API error: ".concat(l.status));return l.json()}}({get:r.Iy,set:r.UC,clear:r.$c}),l=async()=>await s("/form-configurations/all"),n=async e=>await s("/form-configurations",{method:"POST",body:JSON.stringify(e)}),i=async()=>await s("/form-categories/all")},92259:(e,t,a)=>{a.d(t,{f:()=>b});var r=a(95155),s=a(12115),l=a(97168),n=(a(84616),a(99840)),i=a(82714),o=a(89852),d=a(41810),c=a(65453);let u={form_category_id:null,name:"",description:null,status:"draft",form_schema:null},f=(0,c.v)(e=>({draft:u,setMeta:t=>e(e=>({draft:{...e.draft,...t}})),setSchema:t=>e(e=>({draft:{...e.draft,form_schema:t}})),reset:()=>e({draft:u})}));var m=a(87991),p=a(55028),g=a(95784),h=a(26715),x=a(410);let y=(0,p.default)(()=>a.e(508).then(a.bind(a,30508)),{loadableGenerated:{webpack:()=>[30508]},ssr:!1}),v=[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Archived",value:"archived"}];function b(e){var t,a;let{open:c,onOpenChange:u}=e,[p,b]=(0,s.useState)(!1),[w,N]=(0,s.useState)(!1),[j,C]=(0,s.useState)(!1),[A,k]=(0,s.useState)({}),S=(0,h.jE)(),_=void 0!==c,E=_?c:p,L=()=>{_||b(!0),k({}),N(!0),C(!1)},R=()=>{null==u||u(!1),_||b(!1),k({}),N(!1),C(!1)},{categories:T,isLoading:F}=(0,d.H)(),{draft:O,setMeta:U,setSchema:J,reset:z}=f();(0,s.useEffect)(()=>{E?L():(N(!1),C(!1))},[E]);let[D,G]=(0,s.useState)(O.name),[q,I]=(0,s.useState)(null!==(t=O.description)&&void 0!==t?t:""),[B,V]=(0,s.useState)(O.status),[M,$]=(0,s.useState)(O.form_category_id?String(O.form_category_id):"");(0,s.useEffect)(()=>{if(w){var e;G(O.name),I(null!==(e=O.description)&&void 0!==e?e:""),V(O.status),$(O.form_category_id?String(O.form_category_id):"")}},[w]);let H=(0,s.useMemo)(()=>T.map(e=>({value:String(e.id),label:e.name})),[T]),Z=()=>{let e={};return D.trim()||(e.name="Name is required"),M||(e.category="Category is required"),B||(e.status="Status is required"),k(e),0===Object.keys(e).length},P=()=>{z(),R()},Y=async e=>{try{var t,a;J(e);let r={form_category_id:Number(null!==(t=O.form_category_id)&&void 0!==t?t:M),name:O.name||D.trim(),description:null!==(a=O.description)&&void 0!==a?a:q.trim()?q.trim():null,status:O.status||B,form_schema:Array.isArray(e)?e:[JSON.stringify(e)]};await (0,m.Oh)(r),z(),R()}catch(e){console.error("Failed to save form configuration",e)}finally{await S.invalidateQueries({queryKey:[x.mJ]})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.lG,{open:E,onOpenChange:e=>{e?L():R()},children:a=void 0===c&&void 0===u}),(0,r.jsx)(n.lG,{open:w,onOpenChange:e=>e?L():P(),children:(0,r.jsxs)(n.Cf,{className:"w-full max-w-2xl gap-2 flex flex-col items-start",children:[(0,r.jsxs)(n.c7,{className:"p-0",children:[(0,r.jsx)(n.L3,{children:"New Form Details"}),(0,r.jsx)(n.rr,{children:"Enter basic information before building the form"})]}),(0,r.jsx)("div",{className:"w-full pt-0",children:(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(i.J,{htmlFor:"category",children:"Form Category"}),(0,r.jsxs)(g.l6,{value:M,onValueChange:$,disabled:F,children:[(0,r.jsx)(g.bq,{id:"category",className:"w-full",children:(0,r.jsx)(g.yv,{placeholder:F?"Loading categories...":"Select category"})}),(0,r.jsx)(g.gC,{children:H.map(e=>(0,r.jsx)(g.eb,{value:e.value,children:e.label},e.value))})]}),A.category&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:A.category})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(i.J,{htmlFor:"name",children:"Name"}),(0,r.jsx)(o.p,{id:"name",value:D,onChange:e=>G(e.target.value),placeholder:"Enter form name"}),A.name&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:A.name})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(i.J,{htmlFor:"description",children:"Description (optional)"}),(0,r.jsx)(o.p,{id:"description",value:q,onChange:e=>I(e.target.value),placeholder:"Enter description"})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(i.J,{htmlFor:"status",children:"Status"}),(0,r.jsxs)(g.l6,{value:B,onValueChange:e=>V(e),children:[(0,r.jsx)(g.bq,{id:"status",className:"w-full",children:(0,r.jsx)(g.yv,{placeholder:"Select status"})}),(0,r.jsx)(g.gC,{children:v.map(e=>(0,r.jsx)(g.eb,{value:e.value,children:e.label},e.value))})]}),A.status&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:A.status})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)(l.$,{variant:"outline",onClick:P,children:"Cancel"}),(0,r.jsx)(l.$,{onClick:()=>{Z()&&(U({name:D.trim(),description:q.trim()?q.trim():null,status:B,form_category_id:Number(M)}),N(!1),C(!0))},children:"Next"})]})]})})]})}),(0,r.jsx)(n.lG,{open:j,onOpenChange:e=>e?C(!0):P(),children:(0,r.jsxs)(n.Cf,{className:"w-full h-full max-w-full p-0 border-none sm:rounded-none gap-2 flex flex-col items-start",children:[(0,r.jsxs)(n.c7,{className:"p-4",children:[(0,r.jsx)(n.L3,{children:"Create Document Template"}),(0,r.jsx)(n.rr,{children:"Build a custom template for documents and forms"})]}),(0,r.jsx)("div",{className:"flex-1 w-full flex flex-col",children:(0,r.jsx)(y,{setVisibleDialog:e=>e?C(!0):P(),onSave:Y,onCancel:P})})]})})]})}},99840:(e,t,a)=>{a.d(t,{Cf:()=>f,Es:()=>p,L3:()=>g,c7:()=>m,lG:()=>o,rr:()=>h,zM:()=>d});var r=a(95155),s=a(12115),l=a(15452),n=a(54416),i=a(34449);let o=l.bL,d=l.l9,c=l.ZL;l.bm;let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});u.displayName=l.hJ.displayName;let f=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=l.UC.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});g.displayName=l.hE.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});h.displayName=l.VY.displayName}}]);